#!/bin/bash

echo "Running tests before push..."
echo "=============================="

# Activate virtual environment if it exists
if [ -d "venv" ]; then
    source venv/bin/activate
fi

# Run all quality checks
echo "Running linting..."
ruff check .
if [ $? -ne 0 ]; then
    echo "❌ Linting failed. Push aborted."
    exit 1
fi

echo "Checking formatting..."
ruff format --check .
if [ $? -ne 0 ]; then
    echo "❌ Formatting check failed. Push aborted."
    exit 1
fi

echo "Running type checking..."
mypy .
if [ $? -ne 0 ]; then
    echo "❌ Type checking failed. Push aborted."
    exit 1
fi

echo "Running tests..."
pytest --cov=. --cov-report=term-missing
if [ $? -ne 0 ]; then
    echo "❌ Tests failed. Push aborted."
    exit 1
fi

echo "=============================="
echo "✅ All checks passed. Pushing..."
